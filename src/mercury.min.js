/** * Created by alberto on 26/04/16. */'use strict';angular.module('mercury',[]).provider('Mercury',[function MercuryProvider(){var defEndpoint='';function $get($http){function Mercury(endpoint){this.search=function(options){var url=endpoint+'select';var defaults={wt:'json','json.wrf':'JSON_CALLBACK'};angular.extend(defaults,options);return $http.jsonp(url,{params:defaults});};this.withEndpoint=function(url){return new Mercury(url);};} return new Mercury(defEndpoint);} function setEndpoint(url){defEndpoint=url;} return{$get:['$http',$get],setEndpoint:setEndpoint}}]).directive('mercurySearch',[function(){return{restrict:'AE',transclude:true,replace:false,template:'<div data-ng-transclude></div>',scope:{q:'@query',start:'@',rows:'@',sort:'@',fl:'@fields',indexUrl:'@'},controller:['$scope','$rootScope','Mercury',function($scope,$rootScope,Mercury){var searchServ=!$scope.indexUrl?Mercury:Mercury.withEndpoint($scope.indexUrl);var options={q:$scope.q||'*:*',start:$scope.start||0,rows:$scope.rows||10};if($scope.sort) options.sort=$scope.sort;if($scope.fl) options.fl=$scope.fl;searchServ.search(options).then(function(data){var res=data.data.response;var transScope=$scope.$$nextSibling;transScope.solr=$rootScope.solr||{};transScope.solr.results=res.docs;transScope.solr.count=res.numFound;});}]};}]);